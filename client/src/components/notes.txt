server/.env.example

# Backend port
PORT=8000

# MySQL connection string (example)
DATABASE_URL="mysql://codecofdsfpilot_user:StrongPassword123!@localhost:3306/codecopilot"
SHADOW_DATABASE_URL="mysqfsfsdfsfsdfl://root:Shakti@12@localhost:3306/shadowdb"

# OpenAI API key
GEMINI_API_KEY=AIzaSyAIhfsdfsf-KGB_GwYcITFJLq0gFGAxpsNmQX2tc

# JWT secret for user auth
JWT_SECRET="EWQS25554cdfsfsdfdXHWSJW4Y53dfjjksf#@$#@$"

# Frontend origin for CORS
# FRONTEND_ORIGIN=http://fsfsdlocalhost:5173
FRONTEND_ORIGIN=https://code-copisdfsdlot-mu.vercel.app/
# Rate limiting
RATE_LIMIT_WINDOW_MS=60000
RATE_LIMIT_MAX=30


server/prisma/schema.prisma
generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
  shadowDatabaseUrl = env("SHADOW_DATABASE_URL")
}


model User {
  id         Int          @id @default(autoincrement())
  email      String       @unique
  password   String
  generations Generation[]
  createdAt  DateTime     @default(now())
}

model Language {
  id         Int          @id @default(autoincrement())
  name       String
  slug       String       @unique
  extension  String
  generations Generation[]
}

model Generation {
  id          Int      @id @default(autoincrement())
  user        User?    @relation(fields: [userId], references: [id])
  userId      Int?
  language    Language @relation(fields: [languageId], references: [id])
  languageId  Int
  prompt      String
  code        String   @db.LongText
  modelName   String?
  tokensUsed  Int?
  createdAt   DateTime @default(now())

  @@index([createdAt])
  @@index([languageId])
  @@index([userId])
}


server/src/index.js
import dotenv from "dotenv";
dotenv.config();

import express from "express";
import cors from "cors";
import helmet from "helmet";
import rateLimit from "express-rate-limit";

import { authMiddleware } from "./middleware/auth.js";
import { errorHandler } from "./middleware/errorHandler.js";
import { validate } from "./middleware/validate.js";

import {
  registerHandler,
  loginHandler,
  registerSchema,
  loginSchema,
} from "./controllers/auth.controller.js";

import { listLanguages } from "./controllers/languages.controller.js";
import { generateHandler } from "./controllers/generate.controller.js";
import { historyHandler } from "./controllers/history.controller.js";

const app = express();

const FRONTEND = process.env.FRONTEND_ORIaGIN || "http://localhost:5173";
app.use(cors({ origin: FRONTEND }));
app.use(helmet());
app.use(express.json({ limit: "1mb" }));

// attach user if token provided
app.use(authMiddleware);

// rate limit for generate endpoint
const limiter = rateLimit({
  windowMs: Number(process.env.RATE_LIMIT_WINDOW_MS) || 60 * 1000,
  max: Number(process.env.RATE_LIMIT_MAX) || 30,
  standardHeaders: true,
  legacyHeaders: false,
});

// Routes
app.get("/api/languages", listLanguages);

app.post("/api/auth/register", validate(registerSchema), registerHandler);
app.post("/api/auth/login", validate(loginSchema), loginHandler);

// generate
app.post("/api/generate", limiter, generateHandler);

// history
app.get("/api/history", historyHandler);

// health
app.get("/healthz", (req, res) => res.json({ ok: true }));

// error handler (last)
app.use(errorHandler);

// start
const port = process.env.PORT || 8000;
app.listen(port, () => console.log(`Server running on port ${port}`));


render service/.env

